<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SSIDMail - Gmail Style</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Poppins',sans-serif;
  background:#f1f3f4;
  height:100vh;
  display:flex;
  flex-direction:column;
}

/* TOP BAR */
.topbar{
  background:#fff;
  padding:15px 25px;
  box-shadow:0 2px 8px rgba(0,0,0,0.05);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.topbar input{
  padding:8px 12px;
  border-radius:6px;
  border:1px solid #ddd;
  width:200px;
}

/* MAIN LAYOUT */
.main{
  flex:1;
  display:flex;
  overflow:hidden;
}

/* SIDEBAR */
.sidebar{
  width:200px;
  background:#fff;
  border-right:1px solid #e5e7eb;
  padding:20px;
}

.sidebar h3{
  margin-top:0;
  font-size:16px;
}

.sidebar div{
  padding:8px 0;
  cursor:pointer;
}

/* MAIL LIST */
.mail-list{
  width:350px;
  background:#fff;
  border-right:1px solid #e5e7eb;
  overflow-y:auto;
}

.mail-item{
  padding:15px;
  border-bottom:1px solid #f1f1f1;
  cursor:pointer;
}

.mail-item:hover{
  background:#f9fafb;
}

.mail-item.active{
  background:#e8f0fe;
}

.mail-subject{
  font-weight:600;
}

.mail-preview{
  font-size:13px;
  color:#555;
  margin-top:4px;
}

/* MAIL VIEW */
.mail-view{
  flex:1;
  padding:30px;
  overflow-y:auto;
  background:#fff;
}

.mail-view h2{
  margin-top:0;
}

.mail-meta{
  font-size:13px;
  color:#555;
  margin-bottom:15px;
}

iframe{
  width:100%;
  border:none;
}

/* DARK MODE */
body.dark{
  background:#0f172a;
}

body.dark .topbar,
body.dark .sidebar,
body.dark .mail-list,
body.dark .mail-view{
  background:#1e293b;
  color:#f1f5f9;
}

body.dark .mail-item{
  border-bottom:1px solid #334155;
}

body.dark .mail-item:hover{
  background:#334155;
}
</style>
</head>

<body>

<div class="topbar">
  <div>
    <strong>ðŸ“¬ SSIDMail</strong>
  </div>
  <div>
    <input id="username" placeholder="username">
    <button onclick="createEmail()">Open</button>
    <button onclick="toggleDark()">ðŸŒ™</button>
  </div>
</div>

<div class="main">

  <div class="sidebar">
    <h3>Mailbox</h3>
    <div>Inbox</div>
    <div>Spam</div>
  </div>

  <div class="mail-list" id="mailList">
    <div style="padding:20px;">No emails</div>
  </div>

  <div class="mail-view" id="mailView">
    <h2>Select an email</h2>
  </div>

</div>

<script>

const workerURL = "https://email-handler.saisoku-id2020.workers.dev/inbox?email=";

let currentEmails = [];

function createEmail(){
  const user = document.getElementById("username").value.trim();
  if(!user) return;

  const email = user + "@ssidmail.my.id";
  loadInbox(email);
}

async function loadInbox(email){

  try{
    const res = await fetch(workerURL + email + "&t=" + Date.now());
    const data = await res.json();
    currentEmails = data || [];

    renderList();

  }catch(e){
    document.getElementById("mailList").innerHTML = "Failed loading";
  }
}

function renderList(){

  const list = document.getElementById("mailList");

  if(!currentEmails.length){
    list.innerHTML = "<div style='padding:20px;'>No emails</div>";
    return;
  }

  let html = "";

  currentEmails.reverse().forEach((mail,i)=>{
    html += `
      <div class="mail-item" onclick="openMail(${i})">
        <div class="mail-subject">${mail.subject || "(No Subject)"}</div>
        <div class="mail-preview">${(mail.content||"").substring(0,80)}...</div>
      </div>
    `;
  });

  list.innerHTML = html;
}

function openMail(index){

  const mail = currentEmails[currentEmails.length - 1 - index];

  document.querySelectorAll(".mail-item").forEach(el=>el.classList.remove("active"));
  document.querySelectorAll(".mail-item")[index].classList.add("active");

  document.getElementById("mailView").innerHTML = `
    <h2>${mail.subject || "(No Subject)"}</h2>
    <div class="mail-meta">
      From: ${mail.from}<br>
      Date: ${mail.date}
    </div>
    <iframe srcdoc="${mail.content.replace(/"/g,'&quot;')}"></iframe>
  `;
}

/* DARK MODE */
function toggleDark(){
  document.body.classList.toggle("dark");
}

/* AUTO REFRESH */
setInterval(()=>{
  const user = document.getElementById("username").value.trim();
  if(user){
    loadInbox(user + "@ssidmail.my.id");
  }
},30000);

</script>

</body>
</html>
